<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø§Ù„ØªÙˆØ­ÙŠØ¯ ÙˆÙ†ÙˆØ± - Ù…Ù†ØµØ© Ø±Ø³Ø§Ø¦Ù„</title>
  <style>
    :root{--bg:#0b0b0b;--card:#111;--muted:#8b8b8b;--accent:#008cff;--success:#25d366}
    *{box-sizing:border-box}
    body{margin:0;font-family:Tahoma,system-ui,Segoe UI,Roboto,Arial,"Noto Naskh Arabic";background:var(--bg);color:#fff}
    header{background:#000;padding:18px 20px;text-align:center;font-size:26px;font-weight:700}
    .wrap{max-width:1100px;margin:18px auto;padding:12px}
    .row{display:flex;gap:16px}
    .col{background:var(--card);padding:14px;border-radius:12px}
    .sidebar{width:280px}
    .main{flex:1;display:flex;flex-direction:column}
    .input, .select, .btn{width:100%;padding:10px;border-radius:10px;border:none;font-size:16px}
    .input{background:#0d0d0d;color:#fff}
    .btn{background:var(--accent);color:#fff;cursor:pointer}
    .small{font-size:14px;color:var(--muted)}
    .users-list{max-height:400px;overflow:auto;margin-top:10px}
    .user-item{padding:10px;border-radius:8px;margin-bottom:8px;background:#0d0d0d;cursor:pointer}
    .user-item.active{outline:2px solid rgba(0,140,255,0.12)}
    .chat-area{display:flex;flex-direction:column;height:520px}
    .messages{flex:1;overflow:auto;padding:10px;background:#070707;border-radius:10px}
    .msg{padding:8px;margin-bottom:8px;border-radius:10px;max-width:75%}
    .msg.me{background:#063a74;margin-left:auto}
    .msg.other{background:#222}
    .composer{display:flex;gap:8px;margin-top:8px}
    .badge{display:inline-block;padding:6px 10px;border-radius:999px;background:#0b6;border-color:#0b6}
    .whatsapp{position:fixed;left:20px;bottom:20px;background:var(--success);padding:14px;border-radius:50%;color:#fff;font-size:24px;text-decoration:none}
    .tabs{display:flex;gap:8px}
    .tab{padding:8px 12px;background:#0d0d0d;border-radius:8px;cursor:pointer}
    .admin-panel{display:none}
    .notice{background:#111;padding:10px;border-radius:8px;margin-top:8px}
    footer{padding:12px;text-align:center;color:var(--muted)}
    @media(max-width:900px){.row{flex-direction:column}.sidebar{width:100%}}
  </style>
</head>
<body>
  <header>Ù…Ù†ØµØ© Ø§Ù„ØªÙˆØ­ÙŠØ¯ ÙˆÙ†ÙˆØ±</header>

  <div class="wrap">

    <!-- Login / Signup -->
    <div id="authBox" class="col" style="max-width:480px;margin:auto;">
      <h2>ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯ / ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</h2>
      <div style="display:flex;gap:8px;margin-top:10px">
        <input id="authName" class="input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" />
        <input id="authPass" type="password" class="input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" />
      </div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="btn" onclick="signup()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
        <button class="btn" style="background:#555" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
      </div>
      <p class="small">ØªÙ„Ù…ÙŠØ­: Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø£Ø¯Ù…Ù† Ø§Ø³ØªØ®Ø¯Ù… Ø§Ø³Ù…: <strong>admin</strong> ÙˆÙƒÙ„Ù…Ø©: <strong>admin123</strong></p>
      <div class="notice">
        Ù‡Ø°Ø§ Ù†Ø³Ø®Ø© ØªØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø³ÙŠØ±ÙØ± (Static). Ù„Ù„ØªØ´ØºÙŠÙ„ ÙƒØ§Ù…Ù„ Ø­Ù‚ÙŠÙ‚ÙŠ (Ù…Ø²Ø§Ù…Ù†Ø© Ø¨ÙŠÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª) Ø³Ø£Ø±ÙƒØ¨ Ù„Ùƒ Ø¨Ø§Ùƒ-Ø¥Ù†Ø¯ ÙˆÙ‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨.
      </div>
    </div>

    <!-- App -->
    <div id="app" style="display:none">
      <div class="row">
        <div class="col sidebar">
          <div style="display:flex;align-items:center;gap:10px;justify-content:space-between">
            <div>
              <div id="meName" style="font-weight:700;font-size:18px"></div>
              <div id="meEmail" class="small"></div>
            </div>
            <div>
              <button class="btn" style="background:#444;padding:8px 10px;font-size:14px" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
            </div>
          </div>

          <div style="margin-top:12px">
            <div style="display:flex;gap:8px">
              <input id="searchUser" class="input" placeholder="Ø§Ø¨Ø­Ø« Ù…Ø³ØªØ®Ø¯Ù…" oninput="renderUsers()" />
              <button class="btn" style="width:110px" onclick="openNewChat()">Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
            </div>
          </div>

          <h3 style="margin-top:12px">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</h3>
          <div id="usersList" class="users-list"></div>

          <h3 style="margin-top:12px">Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</h3>
          <div id="roomsList" class="users-list"></div>

          <div style="margin-top:12px">
            <button class="btn" onclick="toggleAdmin()">Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</button>
          </div>
        </div>

        <div class="col main">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div id="chatTitle" style="font-weight:700;font-size:20px">Ø§Ø®ØªØ± Ù…Ø³ØªØ®Ø¯Ù…Ø§Ù‹ Ø£Ùˆ Ù‚Ù†Ø§Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</div>
              <div id="chatSub" class="small"></div>
            </div>
            <div class="tabs">
              <div class="tab" onclick="switchTo('public')">Ø¹Ø§Ù…</div>
              <div class="tab" onclick="switchTo('private')">Ø®Ø§Øµ</div>
            </div>
          </div>

          <div class="chat-area">
            <div id="messages" class="messages"></div>

            <div class="composer">
              <input id="msgInput" class="input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." onkeydown="if(event.key==='Enter') sendMessage()" />
              <button class="btn" onclick="sendMessage()">Ø¥Ø±Ø³Ø§Ù„</button>
            </div>
          </div>

          <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
            <div class="small">Ù…Ø´Ø§Ø±ÙƒØ© Ø³Ø±ÙŠØ¹ Ø¹Ø¨Ø±:</div>
            <a id="whLink" href="#" target="_blank" class="small">ÙˆØ§ØªØ³Ø§Ø¨</a>
          </div>
        </div>
      </div>

      <!-- Admin Panel -->
      <div id="adminPanel" class="col admin-panel" style="margin-top:14px">
        <h3>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</h3>
        <div style="display:flex;gap:8px;align-items:center">
          <input id="newRoomName" class="input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø© Ø§Ù„Ø¹Ø§Ù…Ø©" />
          <button class="btn" onclick="createRoom()">Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ù†Ø§Ø©</button>
        </div>
        <div style="margin-top:10px">
          <h4>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</h4>
          <div id="adminUsers" class="users-list"></div>
        </div>
        <div style="margin-top:10px">
          <h4>Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (ÙƒÙ„Ù‡Ø§)</h4>
          <div id="allMsgs" style="max-height:200px;overflow:auto;background:#070707;padding:8px;border-radius:8px"></div>
        </div>
      </div>

    </div>

    <footer>Ø§Ù„ØªÙˆØ­ÙŠØ¯ ÙˆÙ†ÙˆØ± Â© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</footer>
  </div>

  <a class="whatsapp" id="whatsappBtn" href="https://wa.me/201000000000" target="_blank">ğŸ’¬</a>

<script>
// Simple client-side "backend" using localStorage. This is to make the prototype fully functional without server.
// Data structures saved in localStorage:
// users: {username:{password, name}}  -- usernames unique
// rooms: [roomName,...]
// messages: [{id,from,to,room,text,ts}]

const LS_USERS = 'tw_users_v1';
const LS_ROOMS = 'tw_rooms_v1';
const LS_MSGS = 'tw_msgs_v1';
const LS_ME = 'tw_me_v1';

function load(key, def){ const s = localStorage.getItem(key); return s?JSON.parse(s):def; }
function save(key, val){ localStorage.setItem(key, JSON.stringify(val)); }

// init default data
if(!localStorage.getItem(LS_USERS)){
  const u = { 'admin':{password:'admin123',name:'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…'}, 'user1':{password:'1234',name:'Ù…Ø³ØªØ®Ø¯Ù… 1'}, 'user2':{password:'1234',name:'Ù…Ø³ØªØ®Ø¯Ù… 2'} };
  save(LS_USERS,u);
}
if(!localStorage.getItem(LS_ROOMS)) save(LS_ROOMS,['Ø¹Ø§Ù…']);
if(!localStorage.getItem(LS_MSGS)) save(LS_MSGS,[]);

let currentChat = {type:null, id:null}; // type: 'room' or 'user'
let me = load(LS_ME,null);

function signup(){
  const name = document.getElementById('authName').value.trim();
  const pass = document.getElementById('authPass').value.trim();
  if(!name||!pass){alert('Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø³Ø±');return}
  const users = load(LS_USERS,{});
  if(users[name]){alert('Ø§Ù„Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„');return}
  users[name] = {password:pass,name:name};
  save(LS_USERS,users);
  alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨. Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù†.');
}

function login(){
  const name = document.getElementById('authName').value.trim();
  const pass = document.getElementById('authPass').value.trim();
  const users = load(LS_USERS,{});
  if(!users[name] || users[name].password !== pass){alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');return}
  me = {username:name,name:users[name].name};
  save(LS_ME,me);
  showApp();
}

function logout(){ localStorage.removeItem(LS_ME); me=null; location.reload(); }

function showApp(){
  document.getElementById('authBox').style.display='none';
  document.getElementById('app').style.display='block';
  document.getElementById('meName').innerText = me.name + ' ('+me.username+')';
  renderUsers(); renderRooms(); renderAdminUsers(); renderAllMsgs();
}

function renderUsers(){
  const container = document.getElementById('usersList'); container.innerHTML='';
  const users = load(LS_USERS,{});
  const q = document.getElementById('searchUser').value.trim().toLowerCase();
  Object.keys(users).forEach(u=>{
    if(u===me.username) return; // don't show self
    if(q && u.toLowerCase().indexOf(q)===-1 && (users[u].name||'').toLowerCase().indexOf(q)===-1) return;
    const el = document.createElement('div'); el.className='user-item'; el.innerText = users[u].name + ' â€” ' + u;
    el.onclick = ()=>{ openPrivate(u); }
    container.appendChild(el);
  });
}

function renderRooms(){
  const rooms = load(LS_ROOMS,[]);
  const c = document.getElementById('roomsList'); c.innerHTML='';
  rooms.forEach(r=>{
    const el = document.createElement('div'); el.className='user-item'; el.innerText = r;
    el.onclick = ()=>{ openRoom(r); }
    c.appendChild(el);
  });
}

function openPrivate(username){
  currentChat = {type:'user',id:username};
  const users = load(LS_USERS,{});
  document.getElementById('chatTitle').innerText = users[username].name + ' â€” Ù…Ø­Ø§Ø¯Ø«Ø© Ø®Ø§ØµØ©';
  document.getElementById('chatSub').innerText = 'Ø¯Ø±Ø¯Ø´Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨ÙŠÙ†Ùƒ ÙˆØ¨ÙŠÙ† '+users[username].name;
  renderMessages();
}

function openRoom(room){
  currentChat = {type:'room',id:room};
  document.getElementById('chatTitle').innerText = 'Ù‚Ù†Ø§Ø©: ' + room;
  document.getElementById('chatSub').innerText = 'Ù‚Ù†Ø§Ø© Ø¹Ø§Ù…Ø© ÙŠØ±Ø§Ù‡Ø§ ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ù†ØµØ©';
  renderMessages();
}

function sendMessage(){
  const text = document.getElementById('msgInput').value.trim(); if(!text) return;
  const msgs = load(LS_MSGS,[]);
  const id = 'm'+Date.now();
  const item = {id,from:me.username,to: currentChat.type === 'user' ? currentChat.id : null, room: currentChat.type === 'room' ? currentChat.id : null, text, ts: new Date().toISOString() };
  msgs.push(item); save(LS_MSGS,msgs);
  document.getElementById('msgInput').value='';
  renderMessages(); renderAllMsgs();
}

function renderMessages(){
  const box = document.getElementById('messages'); box.innerHTML='';
  if(!currentChat.type){ box.innerHTML = '<div class="small">Ø§Ø®ØªØ± Ù…Ø³ØªØ®Ø¯Ù…Ø§Ù‹ Ø£Ùˆ Ù‚Ù†Ø§Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</div>'; return }
  const msgs = load(LS_MSGS,[]);
  const filtered = msgs.filter(m=>{
    if(currentChat.type==='room') return m.room === currentChat.id;
    return (m.room===null && ((m.from===me.username && m.to===currentChat.id) || (m.from===currentChat.id && m.to===me.username)));
  });
  filtered.forEach(m=>{
    const el = document.createElement('div'); el.className='msg '+(m.from===me.username?'me':'other');
    el.innerHTML = '<div style="font-size:13px;color:var(--muted)">'+m.from+' â€¢ '+(new Date(m.ts)).toLocaleString()+'</div><div style="margin-top:6px">'+escapeHtml(m.text)+'</div>';
    box.appendChild(el);
  });
  box.scrollTop = box.scrollHeight;
  // update share link
  const share = encodeURIComponent((filtered.map(x=>x.from+': '+x.text).join('\n')));
  document.getElementById('whLink').href = 'https://wa.me/?text='+share;
}

function escapeHtml(s){ return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

function openNewChat(){ const name = prompt('Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø¨Ø¯Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹Ù‡ (username)'); if(!name) return; const users = load(LS_USERS,{}); if(!users[name]){ alert('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'); return } openPrivate(name); }

function switchTo(type){ if(type==='public'){ currentChat = {type:'room', id: load(LS_ROOMS,[])[0]}; openRoom(currentChat.id);} else { currentChat = {type:null,id:null}; document.getElementById('chatTitle').innerText='Ø§Ø®ØªØ± Ù…Ø³ØªØ®Ø¯Ù…Ø§Ù‹ Ø£Ùˆ Ù‚Ù†Ø§Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©'; document.getElementById('messages').innerHTML=''; }}

 // Admin features
function toggleAdmin(){
  const isAdmin = me && me.username==='admin';
  if(!isAdmin){ alert('Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† Ù…ØªØ§Ø­Ø© ÙÙ‚Ø· Ù„Ù„Ø£Ø¯Ù…Ù†'); return }
  const p = document.getElementById('adminPanel'); p.style.display = p.style.display==='block'? 'none' : 'block'; renderAdminUsers(); renderAllMsgs();
}

function createRoom(){ const name = document.getElementById('newRoomName').value.trim(); if(!name) return; const rooms = load(LS_ROOMS,[]); if(rooms.includes(name)){alert('Ø§Ù„Ù‚Ù†Ø§Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©');return} rooms.push(name); save(LS_ROOMS,rooms); renderRooms(); document.getElementById('newRoomName').value=''; }

function renderAdminUsers(){ const cont = document.getElementById('adminUsers'); cont.innerHTML=''; const users = load(LS_USERS,{}); Object.keys(users).forEach(u=>{ const el=document.createElement('div'); el.className='user-item'; el.innerText = u + ' â€¢ ' + (users[u].name||''); el.onclick = ()=>{ if(confirm('Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… '+u+' ØŸ')){ delete users[u]; save(LS_USERS,users); renderUsers(); renderAdminUsers(); } }; cont.appendChild(el); }); }

function renderAllMsgs(){ const el = document.getElementById('allMsgs'); if(!el) return; const msgs = load(LS_MSGS,[]); el.innerHTML = msgs.map(m=>('['+new Date(m.ts).toLocaleString()+'] '+m.from+' â†’ '+(m.room||m.to||'')+': '+escapeHtml(m.text))).join('<br/>'); }

// On load check session
window.addEventListener('load',()=>{
  if(me){ showApp(); }
});

// For convenience allow pressing Ctrl+K to focus search
window.addEventListener('keydown',e=>{ if(e.ctrlKey && e.key.toLowerCase()==='k'){ e.preventDefault(); document.getElementById('searchUser').focus(); } });

</script>
</body>
</html>
